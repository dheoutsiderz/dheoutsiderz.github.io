(function($) {
    'use strict';
    $.fn.musicPlaylist = function(options) {
        var settings = $.extend({}, options);
        var container = $('<div id="container"></div>');
        container.insertBefore('#playlist');
        container.css({ width: settings.playerWidth });
        container.append(
            '<div id="audio-player">' +
            '<div id="audio-info">' +
            '<div id="mini">' +
            '<i class="fa fa-compress"></i>' +
            '<i class="fa fa-expand"></i>' +
            '</div>' +
            '<div id="playerColor">' +
            '<span id="title"></span>' +
            '</div>' +
            '<div id="audio-img">' +
            '<div id="cover"></div>' +
            '<div id="controlBar">' +
            '<div id="listDiv">' +
            '<div id="sound" class="soundContainer">' +
            '<i class="fas fa-volume-up"></i>' +
            '<i class="fas fa-volume-off"></i>' +
            '<i class="fas fa-times sound-remove"></i>' +
            '</div>' +
            '<div id="volContainer">' +
            '<div id="volumeBar">' +
            '<div id="volume"></div>' +
            '<div id="volumeH"></div>' +
            '</div>' +
            '</div>' +
            '<div id="audio-buttons" style="padding-bottom: 5px; padding-left: 60px;">' +
            // '<div id="prev" class="btnClass"><i class="fa fa-fast-backward" style="font-size: 16px"></i></div>' +
            // '<div id="play" class="btnClass"><i class="fa fa-play" style="font-size: 22x"></i></div>' +
            // '<div id="pause" class="btnClass"><i class="fa fa-pause" style="font-size: 22px"></i></div>' +
            // '<div id="next" class="btnClass"><i class="fa fa-fast-forward" style="font-size: 16px"></i></div>' +
            '<button type="button" id="prev" class="btn btn-sm m-sm-2 bg-tiga fc-satu" style="padding: 0px 15px;"><i class="bi bi-skip-backward-btn-fill" style="font-size: 20px"></i></button>' +
            '<button type="button" id="play" class="btn btn-sm m-sm-2 bg-tiga fc-satu" style="padding: 0px 15px;"><i class="bi bi-play-btn-fill" style="font-size: 20px"></i></button>' +
            '<button type="button" id="pause" class="btn btn-sm m-sm-2 bg-tiga fc-satu" style="padding: 0px 15px;"><i class="bi bi-pause-btn-fill" style="font-size: 20px"></i></button>' +
            '<button type="button" id="next" class="btn btn-sm m-sm-2 bg-tiga fc-satu" style="padding: 0px 15px;"><i class="bi bi-skip-forward-btn-fill" style="font-size: 20px"></i></button>' +
            '</div>' +
            '<div id="listView"><i class="fa fa-list-ul"></i></div>' +
            '</div>' +
            '<div id="timeContainer">' +
            '<div id="duration"></div>' +
            '<div id="pbContainer">' +
            '<div id="progressBar">' +
            '<div id="progress"></div>' +
            '<div id="progressH"></div>' +
            '</div>' +
            '</div>' +
            '<div id="fti">' +
            '<div id="ftime"></div>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>'
        );
        var playerColor = $('#playerColor');
        var controlBar = $('#controlBar');
        var playlist = $('#playlist');
        var audioImg = $('#audio-img');
        var play = $('#play');
        var pause = $('#pause');
        var progressBar = $('#progressBar');
        var progressVal = $('#progress');
        var progressH = $('#progressH');
        var timeContainer = $('#timeContainer');
        var volumeBar = $('#volumeBar');
        var volumeVal = $('#volume');
        var volumeH = $('#volumeH');
        var duration = $('#duration');
        var sound = $('#sound');
        var mini = $('#mini');
        var listView = $('#listView');
        playerColor.css({ 'background-color': settings.playerColor, opacity: settings.playerOpacity });
        controlBar.css({ 'background-color': settings.playerColor });
        $('#listBtn, #audio-buttons, #duration, #ftime').css('color', settings.iconColor);
        audioImg.addClass('audio-imgA');
        playlist.wrap('<div id="playlistContainer"></div>');
        var playlistContainer = $('#playlistContainer');
        playlistContainer.css({ width: settings.playerWidth }).append('<div id="filter"></div>');
        $('#progressBar, #volumeBar').css({ 'background-color': settings.slidersBackgroundColor });
        $('#progress, #volume').css({ 'background-color': settings.slidersValueColor });
        $('#playlist li')
            .each(function() {
                var cover = $(this).attr('cover');
                var title = $(this).attr('title');
                $(this)
                    .prepend('<div class="txtBox"><span class="txtCenter">' + title + '</span></div>')
                    .prepend('<div class="imgCointeiner" style="background-image: url(' + cover + '); width: ' + settings.trackImageSize + '"></div>');
            })
            .css({ height: settings.trackImageSize, 'border-bottom': 'solid 1px' + settings.separatorColor });
        $('#title').css({ 'font-size': settings.titleSize, color: settings.titleColor, 'font-family': settings.titleFontFamily });
        mini.css({ color: settings.iconColor });
        if (settings.playerSize == 'big') audioImg.css('height', '360px');
        else if (settings.playerSize == 'small') audioImg.css('height', '200px');
        var audio;
        pause.hide();
        initAudio($('#playlist li:first-child'));

        function initAudio(element) {
            var track = element.attr('track');
            var cover = element.attr('cover');
            var data = element.attr('title');
            audio = new Audio(track);
            if (!audio.curentTime) {
                duration.html('0:00');
            }
            $('#audio-player #title').text(data);
            $('#cover').css('background-image', 'url(' + cover + ')');
            $('#playlist li').removeClass('active').css({ 'background-color': 'transparent', 'font-size': settings.trackTextSize, 'font-family': settings.trackFontFamily, color: settings.trackTextColor });
            $('#filter').css({ opacity: settings.playerOpacity, 'background-color': settings.playlistColor });
            element.addClass('active').css({ 'background-color': settings.activeTrackBackground, color: settings.activeTrackTextColor });
            var x = audio.volume * 100;
            volumeVal.css({ width: x + '%' });
            volumeH.css('left', x + '%');
            audio.addEventListener('ended', function() {
                playNext();
            });
            audio.autoplay = 1;
        }
        $(function() {
            fullTime();
            setVolume();
        });
        play.on('click', function() {
            audio.play();
            play.hide();
            pause.show();
            showDuration();
        });
        pause.on('click', function() {
            audio.pause();
            pause.hide();
            play.show();
        });
        $('#next').on('click', function() {
            playNext();
        });
        $('#prev').on('click', function() {
            audio.pause();
            var prev = $('#playlist li.active').prev();
            if (prev.length == 0) {
                prev = $('#playlist li:last-child');
            }
            duration.fadeIn(400);
            initAudio(prev);
            audio.play();
            showDuration();
            fullTime();
            play.hide();
            pause.show();
            sound.removeClass('muted');
            $('.fa-volume-off, .sound-remove').css({ display: 'none' });
            volumeVal.css('width', percentage + '%');
            audio.volume = percentage / 100;
            volumeH.css('left', percentage + '%');
        });

        function showDuration() {
            $(audio).on('timeupdate', function() {
                var s = parseInt(audio.currentTime % 60);
                var m = parseInt(audio.currentTime / 60) % 60;
                if (s < 10) {
                    s = '0' + s;
                }
                duration.html(m + ':' + s);
                var value = 0;
                if (audio.currentTime > 0) {
                    value = Math.floor((100 / audio.duration) * audio.currentTime);
                }
                progressVal.css('width', value + '%');
                progressH.css('left', value + '%');
            });
        }

        function fullTime() {
            setInterval(function() {
                var s = parseInt(audio.duration % 60);
                var m = parseInt(audio.duration / 60) % 60;
                if (s < 10) {
                    s = '0' + s;
                }
                $('#ftime').html(m + ':' + s);
            }, 400);
        }

        function clickedBar(e) {
            if (!audio.paused && !audio.ended) {
                var progressBarSize = progressBar.width();
                var mouseX = e.pageX - progressBar.offset().left;
                var newtime = (mouseX * audio.duration) / progressBarSize;
                audio.currentTime = newtime;
                progressVal.css('width', mouseX + 'px');
            }
        }

        function clickedVol(e) {
            var volBarSize = volumeBar.width();
            var mouseX = e.pageX - volumeBar.offset().left;
            var vol = 0;
            vol = Math.floor((100 * mouseX) / volBarSize);
            volumeVal.css('width', mouseX + 'px');
            audio.volume = parseFloat(vol) / 100;
        }

        function playNext() {
            audio.pause();
            var next = $('#playlist li.active').next();
            if (next.length == 0) {
                next = $('#playlist li:first-child');
            }
            duration.fadeIn(400);
            initAudio(next);
            audio.play();
            showDuration();
            fullTime();
            play.hide();
            pause.show();
            sound.removeClass('muted');
            $('.fa-volume-off, .sound-remove').css({ display: 'none' });
            volumeVal.css('width', percentage + '%');
            audio.volume = percentage / 100;
            volumeH.css('left', percentage + '%');
        }
        var audioImgH = $('#audio-img').height();
        mini.on('click', function() {
            if ($(this).attr('data-click-state') == 0) {
                $(this).attr('data-click-state', 1);
                $('.fa-expand').css({ display: 'none' });
                $('.fa-compress').css({ display: 'block' });
            } else {
                $(this).attr('data-click-state', 0);
                $('.fa-expand').css({ display: 'block' });
                $('.fa-compress').css({ display: 'none' });
            }
            timeContainer.toggleClass('visible_TC, hide_TC');
            controlBar.animate({ height: controlBar.height() == 30 ? 44 : 30 }, 200);
            $('#audio-img').animate({ height: $('#audio-img').height() == audioImgH ? 37 : audioImgH }, 500);
        });
        if (settings.showPlayList == 'show') {
            playlist.css('display', 'block');
            audioImg.addClass('audio-imgB');
        } else {
            playlist.css('display', 'none');
            audioImg.addClass('audio-imgA');
        }
        listView.on('click', function() {
            playlist.slideToggle();
            audioImg.toggleClass('audio-imgA, audio-imgB');
        });
        var percentage;
        sound.on('click', function() {
            audio.muted = !audio.muted;
            $(this).toggleClass('muted');
            $('.fa-volume-off, .sound-remove').css({ display: 'block' });
            if (audio.muted) {
                volumeVal.css('width', 0);
                volumeH.css('left', 0);
            } else {
                volumeVal.css('width', settings.startingVolume + '%');
                volumeH.css('left', settings.startingVolume + '%');
                $('.fa-volume-off, .sound-remove').css({ display: 'none' });
            }
        });
        var volumeDrag = !1;
        volumeBar.on('mousedown', function(e) {
            volumeDrag = !0;
            audio.muted = !1;
            sound.removeClass('muted');
            updateVolume(e.pageX);
        });
        $(document).on('mouseup', function(e) {
            if (volumeDrag) {
                volumeDrag = !1;
                updateVolume(e.pageX);
            }
        });
        $(document).on('mousemove', function(e) {
            if (volumeDrag) {
                updateVolume(e.pageX);
            }
        });
        var isMobile = {
            Android: function() {
                return navigator.userAgent.match(/Android/i);
            },
            BlackBerry: function() {
                return navigator.userAgent.match(/BlackBerry/i);
            },
            iOS: function() {
                return navigator.userAgent.match(/iPhone|iPad|iPod/i);
            },
            Opera: function() {
                return navigator.userAgent.match(/Opera Mini/i);
            },
            Windows: function() {
                return navigator.userAgent.match(/IEMobile/i);
            },
            any: function() {
                return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows();
            },
        };
        $(function() {
            if (isMobile.any()) {
                var eVol = document.getElementById(volumeBar);
                eVol.addEventListener('mouseup', tapOrClick, !1);
                eVol.addEventListener('touchend', tapOrClick, !1);
                var eProgress = document.getElementById(progressVal);
                eProgress.addEventListener('mouseup', tapOrClick, !1);
                eProgress.addEventListener('touchend', tapOrClick, !1);

                function tapOrClick(event) {
                    event.preventDefault();
                    return !1;
                }
            }
        });

        function setVolume() {
            percentage = settings.startingVolume;
            if (percentage == '10') {
                audio.volume = parseFloat(1);
            }
            volumeVal.css('width', percentage + '%');
            audio.volume = percentage / 100;
            volumeH.css('left', percentage + '%');
        }
        var updateVolume = function(x, vol) {
            var volume = volumeBar;
            percentage;
            if (vol) {
                percentage = vol * 100;
            } else {
                var position = x - volume.offset().left;
                percentage = (100 * position) / volume.width();
            }
            if (percentage > 100) {
                percentage = 100;
            }
            if (percentage < 0) {
                percentage = 0;
            }
            volumeVal.css('width', percentage + '%');
            audio.volume = percentage / 100;
            volumeH.css('left', percentage + '%');
            $('.fa-volume-off, .sound-remove').css('display', 'none');
        };
        var timeDrag = !1;
        progressBar.on('mousedown', function(e) {
            timeDrag = !0;
            updatebar(e.pageX);
        });
        $(document).on('mouseup', function(e) {
            if (timeDrag) {
                timeDrag = !1;
                updatebar(e.pageX);
            }
        });
        $(document).on('mousemove', function(e) {
            if (timeDrag) {
                updatebar(e.pageX);
            }
        });
        var updatebar = function(x) {
            var progress = progressBar;
            var maxduration = audio.duration;
            var position = x - progress.offset().left;
            var percentage = (100 * position) / progress.width();
            if (percentage > 100) {
                percentage = 100;
            }
            if (percentage < 0) {
                percentage = 0;
            }
            progressVal.css('width', percentage + '%');
            progressH.css('left', percentage + '%');
            audio.currentTime = (maxduration * percentage) / 100;
        };
        $('#playlist li').on('click', function() {
            audio.pause();
            audio.currentTime = 0;
            initAudio($(this));
            audio.play();
            showDuration();
            fullTime();
            play.hide();
            pause.show();
            if (sound.hasClass('muted')) {
                audio.muted = !0;
                volumeVal.css('width', 0);
                volumeH.css('left', 0);
            } else {
                audio.muted = !1;
                volumeVal.css('width', settings.startingVolume + '%');
                audio.volume = percentage / 100;
                volumeH.css('left', settings.startingVolume + '%');
            }
        });
        controlBar.on('mouseenter', function() {
            $(this).css({ opacity: '1' });
        });
        controlBar.on('mouseleave', function() {
            $(this).css({ opacity: '0.8' });
        });
        $('.fa-volume-off, .sound-remove').css('display', 'none');
        audioImg.on('click', function() {
            if ($(this).attr('data-click-state') == 1) {
                $(this).attr('data-click-state', 0);
                audio.pause();
                pause.hide();
                play.show();
            } else {
                $(this).attr('data-click-state', 1);
                audio.play();
                showDuration();
                fullTime();
                play.hide();
                pause.show();
            }
        });
        controlBar.on('click', function(e) {
            e.stopPropagation();
        });
    };
})(jQuery);